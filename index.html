<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sudoku Solver From Image</title>
  <link rel="icon" href="icon.png" type="image/x-icon" />
  <link rel="manifest" href="/manifest.json" />
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      /* Add padding-top to body to prevent content from being hidden under the fixed header */
      padding-top: 100px; /* Adjust this value based on the actual header height */
    }
    #result-container {
      transition: opacity 0.5s ease-in-out;
    }
    /* Custom style for the loader spinner */
    .loader-spinner {
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top: 4px solid #8b5cf6; /* violet-500 */
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  .share-container {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 999;
  }

  .share-button, .share-options a {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    border: none;
    background: white;
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
    cursor: pointer;
    transition: transform 0.2s ease;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 8px;
  }

  .share-button:hover,
  .share-options a:hover {
    transform: translateY(-5px);
  }

  .share-button img {
    width: 60%;
  }

  .share-options {
    display: none;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    margin-bottom: 10px;
  }

  .share-options a img {
    width: 65%;
  }

  .bounce {
    animation: bounce 1.5s infinite;
  }

  @keyframes bounce {
    0%, 100% {
      transform: translateY(0);
    }
    50% {
      transform: translateY(-8px);
    }
  }
  </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-slate-200 min-h-screen flex flex-col items-center text-slate-800">

  <!-- Fixed Header -->
  <header class="fixed top-0 left-0 right-0 z-50 bg-white/80 backdrop-blur-sm shadow-md border-b border-slate-200">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between h-20">
      <!-- Logo and Title Section -->
      <div class="flex items-center gap-3">
        <img src="logo.svg" alt="Sudoku Solver Logo" class="h-12 w-12 object-contain rounded-full shadow-sm hover:shadow-md transition-shadow" onerror="this.onerror=null;this.src='https://placehold.co/48x48/aabbcc/ffffff?text=LOGO';" />
        <h1 class="text-xl sm:text-2xl font-bold text-slate-900 tracking-tight">Sudoku Vision</h1>
      </div>

      <!-- Social Links Section -->
      <div class="flex items-center gap-2 sm:gap-3 text-slate-500">
        <a href="https://www.facebook.com/profile.php?id=61576823879176&mibextid=rS40aB7S9Ucbxw6v" target="_blank" rel="noopener noreferrer" class="p-2 rounded-full hover:bg-violet-100 hover:text-violet-600 transition-colors">
          <img src="facebook.svg" alt="Facebook" class="w-6 h-6" onerror="this.onerror=null;this.src='https://placehold.co/24x24/3b5998/ffffff?text=FB';" />
        </a>
        <a href="https://www.instagram.com/mohanty.satyaprakash.22/" target="_blank" rel="noopener noreferrer" class="p-2 rounded-full hover:bg-violet-100 hover:text-violet-600 transition-colors">
          <img src="instagram.svg" alt="Instagram" class="w-6 h-6" onerror="this.onerror=null;this.src='https://placehold.co/24x24/C13584/ffffff?text=IG';" />
        </a>
        <a href="https://mobile.x.com/SubashChan12922" target="_blank" rel="noopener noreferrer" class="p-2 rounded-full hover:bg-violet-100 hover:text-violet-600 transition-colors">
          <img src="twitter.svg" alt="Twitter/X" class="w-6 h-6" onerror="this.onerror=null;this.src='https://placehold.co/24x24/000000/ffffff?text=X';" />
        </a>
        <a href="https://pin.it/1ZWNQjRrb" target="_blank" rel="noopener noreferrer" class="p-2 rounded-full hover:bg-violet-100 hover:text-violet-600 transition-colors">
          <img src="pinterest.svg" alt="Pinterest" class="w-6 h-6" onerror="this.onerror=null;this.src='https://placehold.co/24x24/BD081C/ffffff?text=PI';" />
        </a>
        <a href="https://www.youtube.com/@SubashChandraMohanty-ml2lw" target="_blank" rel="noopener noreferrer" class="p-2 rounded-full hover:bg-violet-100 hover:text-violet-600 transition-colors">
          <img src="youtube.svg" alt="YouTube" class="w-6 h-6" onerror="this.onerror=null;this.src='https://placehold.co/24x24/FF0000/ffffff?text=YT';" />
        </a>
        <a href="mailto:satyaprakashmohanty2008@gmail.com" class="p-2 rounded-full hover:bg-violet-100 hover:text-violet-600 transition-colors">
          <img src="email.svg" alt="Email" class="w-6 h-6" onerror="this.onerror=null;this.src='https://placehold.co/24x24/7f8c8d/ffffff?text=EM';" />
        </a>
      </div>
    </div>
  </header>

  <!-- Main content area -->
  <main class="max-w-2xl w-full p-4 sm:p-6 lg:p-8 mt-24">
    <!-- Drop Zone -->
    <div id="drop-zone" class="relative block w-full rounded-lg border-2 border-dashed border-slate-300 p-12 text-center hover:border-violet-400 focus:outline-none focus:ring-2 focus:ring-violet-500 focus:ring-offset-2 transition-all duration-200 ease-in-out cursor-pointer bg-white/50 shadow-sm hover:shadow-md">
      <div class="flex flex-col items-center justify-center">
        <svg class="mx-auto h-12 w-12 text-slate-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true">
          <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
        <span class="mt-2 block text-sm font-semibold text-slate-600">
          Drop your Sudoku image here or <span class="text-violet-600">click to upload</span>
        </span>
      </div>
    </div>
    <input type="file" id="file-input" class="hidden" accept="image/*" />

    <!-- Loader -->
    <div id="loader" class="hidden flex-col items-center justify-center mt-8 text-violet-600">
      <div class="loader-spinner mb-3"></div>
      <span class="text-lg font-medium">Solving Puzzle...</span>
    </div>

    <!-- Result Section -->
    <div id="result-container" class="hidden mt-8 text-center">
      <!-- Message Display -->
      <p id="message" class="text-lg font-medium text-slate-800"></p>

      <!-- Result Image -->
      <div class="mt-4 relative inline-block">
        <img id="result" class="max-w-full h-auto rounded-lg shadow-lg border-2 border-slate-200" alt="Solved Sudoku" />
      </div>

      <!-- Download Button -->
      <button id="download-btn" class="mt-6 w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-violet-600 hover:bg-violet-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-violet-500 transition-transform transform hover:scale-105">
        <svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
        </svg>
        Download Solved Image
      </button>
    </div>
  </main>

  <script>
    // Get references to DOM elements
    const dropZone = document.getElementById('drop-zone');
    const fileInput = document.getElementById('file-input');
    const loader = document.getElementById('loader');
    const resultContainer = document.getElementById('result-container');
    const resultImg = document.getElementById('result');
    const message = document.getElementById('message');
    const downloadBtn = document.getElementById('download-btn');

    // Define the API endpoint for the Sudoku solver (now pointing to your Vercel serverless function)
    const API_URL = "/api/solve"; 

    // Event listener for click on the drop zone to trigger file input
    dropZone.addEventListener('click', () => fileInput.click());

    // Event listener for file input change (when a file is selected)
    fileInput.addEventListener('change', () => {
      if (fileInput.files[0]) {
        handleFileUpload(fileInput.files[0]);
      }
    });

    // Event listener for 'dragover' on the drop zone
    dropZone.addEventListener('dragover', (e) => {
      e.preventDefault(); // Prevent default to allow drop
      dropZone.classList.add('border-blue-600', 'bg-blue-100'); // Add visual feedback for dragover
    });

    // Event listener for 'dragleave' on the drop zone
    dropZone.addEventListener('dragleave', () => {
      dropZone.classList.remove('border-blue-600', 'bg-blue-100'); // Remove visual feedback
    });

    // Event listener for 'drop' on the drop zone
    dropZone.addEventListener('drop', (e) => {
      e.preventDefault(); // Prevent default browser handling of dropped files
      dropZone.classList.remove('border-blue-600', 'bg-blue-100'); // Remove visual feedback
      const file = e.dataTransfer.files[0]; // Get the dropped file
      if (file) {
        handleFileUpload(file); // Process the file
      }
    });

    // Event listener for the download button
    downloadBtn.addEventListener('click', () => {
      if (!resultImg.src || resultImg.src.startsWith('data:image/png;base64,')) {
        // Create a temporary anchor element to trigger the download
        const a = document.createElement('a');
        a.href = resultImg.src;
        a.download = 'solved_sudoku.png'; // Set the download file name
        document.body.appendChild(a); // Append to body (required for Firefox)
        a.click(); // Programmatically click the anchor to trigger download
        document.body.removeChild(a); // Clean up the temporary anchor
      } else {
        // Handle cases where the image might be a direct URL if the API changes
        // For now, it's expected to be a base64 string.
        console.error("Image source is not a base64 string, cannot download directly.");
      }
    });

    /**
     * Handles the file upload process, sending the image to the API for solving.
     * @param {File} file The image file to be uploaded.
     */
    async function handleFileUpload(file) {
      // Create a FormData object to send the file
      const formData = new FormData();
      formData.append("file", file); // Append the file with the key "file"

      // Show loader and hide result container
      loader.classList.remove('hidden');
      resultContainer.classList.add('hidden');
      message.textContent = '';
      resultImg.src = '';

      try {
        // Make a POST request to the API
        const res = await fetch(API_URL, {
          method: "POST",
          body: formData
        });

        const data = await res.json();
        loader.classList.add('hidden');

        if (data.image) {
          message.textContent = data.message || "Sudoku solved successfully!";
          message.classList.remove('text-red-600');
          resultImg.src = `data:image/png;base64,${data.image}`;
          resultContainer.classList.remove('hidden');
        } else {
          message.textContent = data.message || "Failed to solve Sudoku. Please try another image.";
          message.classList.add('text-red-600');
          resultContainer.classList.remove('hidden'); // Show container to display the message
          resultImg.classList.add('hidden');
          downloadBtn.classList.add('hidden');
        }
      } catch (err) {
        loader.classList.add('hidden');
        message.textContent = "An error occurred: " + err.message;
        message.classList.add('text-red-600');
        resultContainer.classList.remove('hidden');
        resultImg.classList.add('hidden');
        downloadBtn.classList.add('hidden');
        console.error("Fetch error:", err);
      }
    }
  </script>
  <div class="share-container fixed bottom-5 right-5 z-50">
    <div class="share-options" id="share-options" style="display: none; flex-direction: column; gap: 0.75rem; margin-bottom: 0.75rem;">
      <a onclick="shareTo('whatsapp')" title="WhatsApp" class="flex items-center justify-center w-14 h-14 rounded-full bg-white shadow-md hover:bg-violet-100 transition-colors transform hover:-translate-y-1">
        <img src="whatsapp.svg" alt="WhatsApp" class="w-7 h-7">
      </a>
      <a onclick="shareTo('facebook')" title="Facebook" class="flex items-center justify-center w-14 h-14 rounded-full bg-white shadow-md hover:bg-violet-100 transition-colors transform hover:-translate-y-1">
        <img src="fb.svg" alt="Facebook" class="w-7 h-7">
      </a>
      <a onclick="shareTo('instagram')" title="Instagram" class="flex items-center justify-center w-14 h-14 rounded-full bg-white shadow-md hover:bg-violet-100 transition-colors transform hover:-translate-y-1">
        <img src="ins.svg" alt="Instagram" class="w-7 h-7">
      </a>
      <a onclick="shareTo('telegram')" title="Telegram" class="flex items-center justify-center w-14 h-14 rounded-full bg-white shadow-md hover:bg-violet-100 transition-colors transform hover:-translate-y-1">
        <img src="telegram.svg" alt="Telegram" class="w-7 h-7">
      </a>
    </div>
    <button onclick="toggleShare()" class="w-16 h-16 rounded-full bg-violet-600 text-white shadow-lg hover:bg-violet-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-violet-500 flex items-center justify-center transform hover:scale-110 transition-transform">
      <svg class="w-8 h-8" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12s-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6.002l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z" />
      </svg>
    </button>
  </div>
  <script>
  const shareOptions = document.getElementById("share-options");
  const shareUrl = encodeURIComponent("https://satyaprakashmohanty13.github.io/sudoku-solver-from-image/"); // Replace with your actual site

  function toggleShare() {
    shareOptions.style.display = (shareOptions.style.display === "flex") ? "none" : "flex";
  }

  function shareTo(platform) {
    let url = "";
    switch (platform) {
      case "whatsapp":
        url = `https://wa.me/?text=${shareUrl}`;
        break;
      case "facebook":
        url = `https://www.facebook.com/sharer/sharer.php?u=${shareUrl}`;
        break;
      case "instagram":
        // Instagram does not support direct web sharing from a URL
        // You might consider a custom modal or just a message here
        alert("Instagram does not support direct web sharing. Please share manually from the app.");
        return;
      case "telegram":
        url = `https://t.me/share/url?url=${shareUrl}`;
        break;
      default:
        return;
    }
    if (url) window.open(url, "_blank");
  }
</script>
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/sw.js')
        .then(registration => {
          console.log('ServiceWorker registration successful with scope: ', registration.scope);
        })
        .catch(error => {
          console.log('ServiceWorker registration failed: ', error);
        });
    });
  }
</script>
</body>
</html>
